spec_version: 2
description: Quali + Raftt Demo (robot-shop)

inputs:
  nodeport:
    type: string
    default: false
  openshift:
    type: string
    default: false
  ocCreateRoute:
    type: string
    default: false
  namespace:
    type: string
  host_name:
    type: execution-host

outputs:
  URL:
    value: 'http://{{.grains.helm.scripts.post-helm-install.outputs.frontend}}:8080'
    kind: link
  Develop with Raftt:
    value: 'raftt connect {{.inputs.namespace}}'

grains:
  namespace:
    kind: helm
    spec:
      source:
        store: robot-shop
        path: K8s/namespace
      host:
        name: '{{ .inputs.host_name }}'
      inputs:
      - namespace_name: '{{ .inputs.namespace }}'
      env-vars: []
      commands:
      - dep up K8s/namespace
  helm:
    kind: helm
    depends-on: namespace
    spec:
      source:
        store: robot-shop
        path: K8s/helm
      namespace: '{{ .inputs.namespace }}'
      host:
        name: '{{ .inputs.host_name }}'
      scripts:
        post-helm-install:
          source:
            store: robot-shop
            path:  scripts/get-robot-web-address.sh
          arguments: '{{ .inputs.namespace }}'
          outputs:
            - frontend
      inputs:
      - nodeport: '{{ .inputs.nodeport }}'
      - openshift: '{{ .inputs.openshift }}'
      - ocCreateRoute: '{{ .inputs.ocCreateRoute }}'
      - namespace: '{{ .inputs.namespace }}'
      env-vars: []
      commands:
      - dep up K8s/helm
